<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>회원가입</title>

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Noto Sans KR", system-ui, -apple-system,
          BlinkMacSystemFont, "Segoe UI", sans-serif;
        background-color: #f4f6fb;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .signup-wrapper {
        width: 380px;
        padding: 48px 56px 40px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 20px 40px rgba(15, 23, 42, 0.12);
      }

      .signup-title {
        margin-bottom: 32px;
        text-align: center;
        font-size: 28px;
        font-weight: 700;
        color: #111827;
      }

      .signup-form {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .input-box {
        position: relative;
      }

      .input-box input {
        width: 100%;
        height: 52px;
        padding: 0 16px;
        border-radius: 10px;
        border: none;
        outline: none;
        background-color: #e5e7eb;
        font-size: 14px;
        color: #111827;
      }

      .input-box input::placeholder {
        color: #9ca3af;
      }

      .input-box p {
        position: absolute;
        bottom: -18px;
        left: 4px;
        font-size: 12px;
        margin: 0;
      }

      .input-box p.invalid {
        color: #e11d48;
      }

      .input-box p.valid {
        color: #16a34a;
      }

      .btn-submit {
        margin: 28px auto 0;
        width: 60%;
        height: 50px;
        border-radius: 10px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: not-allowed;
        background-color: #2563eb;
        color: #ffffff;
        box-shadow: 0 10px 20px rgba(148, 163, 184, 0.4);
        transition: background-color 0.25s ease, transform 0.1s ease;
        display: block;
      }

      .btn-submit.enabled {
        cursor: pointer;
        background-color: #2563eb;
        box-shadow: 0 10px 20px rgba(37, 99, 235, 0.4);
      }

      .btn-submit.enabled:active {
        transform: translate(1px, 1px);
      }

      .signup-bottom {
        margin-top: 28px;
        text-align: center;
        font-size: 14px;
        color: #4b5563;
      }

      .signup-bottom a {
        margin-left: 4px;
        text-decoration: none;
        color: #2563eb;
        font-weight: 500;
      }

      .signup-bottom a:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <div class="signup-wrapper">
      <h1 class="signup-title">회원가입</h1>

      <!-- 백엔드로 POST 전송 -->
      <form class="signup-form" th:action="@{/login/signup}" method="post">
        <!-- 이메일 -->
        <div class="input-box">
          <input
            type="email"
            id="email-input"
            name="email"
            placeholder="이메일을 입력하세요"
            required
          />
          <p id="email-msg"></p>
        </div>

        <!-- 비밀번호 -->
        <div class="input-box">
          <input
            type="password"
            id="pw-input"
            name="pwd"
            placeholder="비밀번호를 입력하세요"
            required
          />
          <p id="pw-msg"></p>
        </div>

        <!-- 닉네임 -->
        <div class="input-box">
          <input
            type="text"
            id="nickname-input"
            name="nickname"
            placeholder="닉네임을 입력하세요"
            required
          />
          <p id="nickname-msg"></p>
        </div>

        <button class="btn-submit" type="submit" disabled>회원가입</button>
      </form>

      <p class="signup-bottom">
        이미 계정이 있으신가요?
        <a th:href="@{/login}">로그인</a>
      </p>
    </div>

    <script>
      // 정규 표현식
      const regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // 기본 이메일 패턴
      const regexPw =
        /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?`~]).{8,}$/;
      const regexNickname = /^[가-힣a-zA-Z0-9]{2,12}$/;

      // input 요소
      const emailInput = document.getElementById("email-input");
      const pwInput = document.getElementById("pw-input");
      const nicknameInput = document.getElementById("nickname-input");

      // 메시지 요소
      const emailMsg = document.getElementById("email-msg");
      const pwMsg = document.getElementById("pw-msg");
      const nicknameMsg = document.getElementById("nickname-msg");

      // 버튼
      const submitBtn = document.querySelector(".btn-submit");

      // 공통 검사 함수
      const validateInput = (input, regex, msgEl, successText) => {
        const value = input.value.trim();

        // 아무 것도 안 적었으면 메시지 제거
        if (value === "") {
          msgEl.textContent = "";
          msgEl.classList.remove("valid");
          msgEl.classList.remove("invalid");
          return false;
        }

        if (regex.test(value)) {
          msgEl.textContent = successText;
          msgEl.classList.add("valid");
          msgEl.classList.remove("invalid");
          return true;
        } else {
          msgEl.textContent = "입력 조건이 맞지 않습니다.";
          msgEl.classList.add("invalid");
          msgEl.classList.remove("valid");
          return false;
        }
      };

      const updateSubmitBtn = () => {
        const isEmailValid = validateInput(
          emailInput,
          regexEmail,
          emailMsg,
          "사용 가능한 이메일입니다."
        );
        const isPwValid = validateInput(
          pwInput,
          regexPw,
          pwMsg,
          "사용 가능한 비밀번호입니다."
        );
        const isNicknameValid = validateInput(
          nicknameInput,
          regexNickname,
          nicknameMsg,
          "사용 가능한 닉네임입니다."
        );

        if (isEmailValid && isPwValid && isNicknameValid) {
          submitBtn.disabled = false;
          submitBtn.classList.add("enabled");
        } else {
          submitBtn.disabled = true;
          submitBtn.classList.remove("enabled");
        }
      };

      // 입력 이벤트 등록
      emailInput.addEventListener("input", updateSubmitBtn);
      pwInput.addEventListener("input", updateSubmitBtn);
      nicknameInput.addEventListener("input", updateSubmitBtn);
    </script>
  </body>
</html>
